### golang动态代理

#### 背景

&nbsp;&nbsp;&nbsp;&nbsp; Java里动态代理的实现有多种不同的方式，多是通过字节码增强方式进行实现的。java由于底层有虚拟机的一个环境，class编译为字节码在虚拟机上层运行，所以java动态代理很容易实现。

&nbsp;&nbsp;&nbsp;&nbsp; 但是golang里没有虚拟机这个概念，代码直接编译为可执行的二进制文件，在真正实现动态代理的方法上受到很大制约，亦即并没有原生库支持。比较常用的是pig和monkey这两个代表，他们大概的方式简单归纳为都是类似于通过对编译后的汇编语言进行一定的侵入，也就是在二进制文件级别进行打桩的操作，这种方式有比较强暴直接。

&nbsp;&nbsp;&nbsp;&nbsp; 今天这里介绍的方式，是在golang的语言范围里的，通过golang提供的反射的基础上进行实现的，纯golang代码级别的实现，所以在性能上可能有所欠佳。本方案使用代理的设计模式（而不是增强类型）间接实现了动态代理。实现思想为：创建一个新的代理对象，将目标要执行的执行目标（此处是方法）封装到代理主体的interceptor中。使用的步骤分如下：

*   创建真实类
*   根据真实类型创建代理类型，增加增强处理函数
*   使用代理调用Call方法触发代理执行

#### 总结
- 本实现只是实现了接收器实现方法的情况（若接口在结构体，可以直接使用增强型方案修改原对象的执行目标）
- 本方案未使用增强型（增强之后替换执行目标）方案，就是因为：运行时，无法动态更改方法集的内容或添加或删除方法「存在方法区，无法获取地址」
- 使用反射实现的方案性能有所欠佳，需要慎重

#### 参考文献
- https://zhuanlan.zhihu.com/p/392197983
- https://github.com/cocotyty/dpig/tree/main